#include <Keypad.h>

#include <LiquidCrystal_PCF8574.h>

#include <Wire.h>
//движок подключаем
int dir=13,stp=2,num;
LiquidCrystal_PCF8574 lcd(0x27);
const byte ROWS=4;
const byte COLS=4;
int check = 0;// Это переменная ограничивает вводимый угол.
int st;
int angle=0;
char key;
char keys[ROWS][COLS] = {
  {'1','2','3','A',},
  {'4','5','6','B'},
  {'7','8','9','C'},
  {'*','0','#','D'}
};
byte rowPins[ROWS]={11,10,9,8};
byte colPins[COLS]={7,6,5,4};
Keypad keypad=Keypad(makeKeymap(keys),rowPins,colPins,ROWS,COLS);

void setup() {
  lcd.begin(16, 2);
  lcd.setBacklight(255);
  lcd.clear();
  lcd.setCursor(0,1);
  pinMode(dir,OUTPUT);
  pinMode(stp,INPUT);
  digitalWrite(dir,HIGH);
  

}

void loop() {
  key=' ';
  if(key){
    lcd.clear();
    lcd.setCursor(0,0);
    lcd.print("MR -> press A");// Это ручной режим, я в нём только угол поворота пока ввёл
    lcd.setCursor(0,1);
    lcd.print("AR -> press b");// Это автоматический, он вообще пока пустой
    while(key == ' ') key=keypad.getKey();
    if(key == 'A'){
      lcd.clear();
      lcd.print("Print angle:");
      lcd.setCursor(0,1);
      char key1=' ';
      check=0;
      num = 0;
      st=100;//Это по сути костыль для нормально перевода строки в число. 
      while((key1 != '*') && (check < 3)){
        key1=keypad.getKey();// Здесь по символьно вводится угол поворота в формате 090 - это 90 градусов, 008, 8 градусов.
        if(key1){
        lcd.print(key1);
        num = num + st*((int)key1-48);//Максимально тупой способ через кодировку ACII
        st = (int)(st/10);
        check++;
        
        }
      }
      lcd.clear();
      lcd.print("Press * to st");
      key1=' ';
      while(key1!='*') key1=keypad.getKey();
      digitalWrite(dir,HIGH);// Тут идёт сначала поворот на заданный угол, а потом обратно в начальное положение. И тут надо num=num/1.8
      num=(int)(num*200/360);
      for(int x=0; x<num; x++){
         digitalWrite(stp,HIGH);
         delay(5);
         digitalWrite(stp,LOW);
         delay(5);
      }
      delay(1000);
      lcd.clear();
      lcd.print("Thank you");
      delay(1000);
      digitalWrite(dir,LOW);
      for(int x=0; x<num; x++){
         digitalWrite(stp,HIGH);
         delay(5);
         digitalWrite(stp,LOW);
         delay(5);
      }
      
      
    }
      
  }
}
